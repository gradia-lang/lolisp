<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Lolisp</title>
        <script
            src="https://gradia-lang.github.io/gradia.js"
            type="module"
        ></script>
    </head>

    <body>
        <div id="title">
            <h1>Lolisp</h1>
            <button onclick="run_lolisp()">▶️</button>
        </div>
        
        <div id="editor" contenteditable="true">
            <div class="list">
                <div class="atom">define</div>
                <div class="data">
                    <div class="atom">inc</div>
                    <div class="atom">n</div>
                    <span>&ThinSpace;</span>
                </div>
                <div class="data">
                    <div class="atom">+</div>
                    <div class="atom">n</div>
                    <div class="atom">1</div>
                    <span>　</span>
                </div>
                <span>&ThinSpace;</span>
            </div>
            <div class="list">
                <div class="atom">inc</div>
                <div class="atom">5</div>
                <span>&ThinSpace;</span>
            </div>
            <span>&ThinSpace;</span>
        </div>
        <br>

        <span style="font-size: 100px">↪︎</span>
        <pre id="result"> </pre>
    </body>

    <script>
        var pallet;

        function run_lolisp() {
            let gradia = new Gradia();
            let editor = document.getElementById("editor");
            let source = editor.children;

            for (let line of source) {
                code = compile(line);
                console.log(code);

                let result = gradia.eval(code);
                if (result != "") {
                    let elm = document.getElementById("result");
                    elm.innerHTML = result;
                }
            }
        }

        function compile(source) {
            source.setAttribute("contenteditable", true);
            if (source.className == "list") {
                let list = [];
                let children = source.children;
                for (let item of children) {
                    list.push(compile(item));
                }
                return `(${list.join(" ")})`
            } else if (source.className == "data") {
                let list = [];
                let children = source.children;
                for (let item of children) {
                    list.push(compile(item));
                }
                return `'(${list.join(" ")})`
            } else if (source.className == "atom") {
                return source.innerText;
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("editor").focus();
        })
    </script>

    <style>
        #result, button, .list, .atom, .data, h1, #title, #editor, #pallet  {
            display: inline-block;
            border-radius: 10px;
            padding: 10px;
            margin: 2px;
        }

        #pallet {
            display: inline; 
        }

        #pallet:focus {
            outline: none;
        }

        #title {
            width: 97vw;
            align-items: center;
            background-color: lightblue;
        }
        #title h1 {
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            height: 50px;
        }



        span, #title h1  {
            color: darkslategrey;
        }

        #title button {
            background-color: transparent;
            padding: 0;
            margin-right: 1vh;
            border-style: none;
            font-size: 30px;
        }

        body {
            font-family: monospace;
            font-size: large;
            margin: 2vh;
            user-select: none;
        }

        #editor {
            margin-top: 20px;
            margin-bottom: 10px;
            padding: 30px;
        }

        #result {
            padding-left: 50px;
            padding-right: 50px;
            padding-top: 30px;
            padding-bottom: 30px;

            background-color: lightgray;
            border: 1px solid black;
        }

        .list {
            background-color: aliceblue;
            border: 1px solid blue;
        }

        .data {
            background-color: rgb(195, 239, 195);
            border: 1px solid green;
        }

        .atom {
            background-color: whitesmoke;
            border: 1px solid black;
        }
    </style>
</html>
